name: Deploy

on:
  workflow_call:
    inputs:
      artifact-name:
        required: true
        type: string
    secrets:
      GH_PAT:
        required: true

permissions: {}

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Target Repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          repository: 'StarryBlueSky/TVTest-distribution'
          token: '${{ secrets.GH_PAT }}'

      - name: Download Artifact
        uses: actions/download-artifact@37930b1c2abaa49bbe596cd826c3c89aef350131 # v7.0.0
        with:
          name: '${{ inputs.artifact-name }}'

      - name: Prepare Commit Message
        id: message
        run: echo "::set-output name=commit_message::ðŸ†™ `date '+%Y-%m-%d'` (${ARTIFACT_NAME}, ${COMMIT_HASH:0:7})"
        env:
          TZ: 'Asia/Tokyo'
          ARTIFACT_NAME: '${{ inputs.artifact-name }}'
          COMMIT_HASH: '${{ github.sha }}'

      - name: Pull
        run: git pull

      - name: Push to Target Repository
        uses: stefanzweifel/git-auto-commit-action@04702edda442b2e678b25b537cec683a1493fcb9 # v7.1.0
        continue-on-error: true
        with:
          commit_message: '${{ steps.message.outputs.commit_message }}'
          commit_author: 'StarryBlueSky-bot <97773209+StarryBlueSky-bot@users.noreply.github.com>'
