name: Deploy

on:
  workflow_call:
    inputs:
      artifact-name:
        required: true
        type: string
    secrets:
      GH_PAT:
        required: true

permissions: {}

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Target Repository
        uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4
        with:
          repository: 'StarryBlueSky/TVTest-distribution'
          token: '${{ secrets.GH_PAT }}'

      - name: Download Artifact
        uses: actions/download-artifact@d3f86a106a0bac45b974a628896c90dbdf5c8093 # v4.3.0
        with:
          name: '${{ inputs.artifact-name }}'

      - name: Prepare Commit Message
        id: message
        run: echo "::set-output name=commit_message::ðŸ†™ `date '+%Y-%m-%d'` (${ARTIFACT_NAME}, ${COMMIT_HASH:0:7})"
        env:
          TZ: 'Asia/Tokyo'
          ARTIFACT_NAME: '${{ inputs.artifact-name }}'
          COMMIT_HASH: '${{ github.sha }}'

      - name: Pull
        run: git pull

      - name: Push to Target Repository
        uses: stefanzweifel/git-auto-commit-action@b863ae1933cb653a53c021fe36dbb774e1fb9403 # v5.2.0
        continue-on-error: true
        with:
          commit_message: '${{ steps.message.outputs.commit_message }}'
          commit_author: 'StarryBlueSky-bot <97773209+StarryBlueSky-bot@users.noreply.github.com>'
